"use strict";
/*
  This file is part of web3x.

  web3x is free software: you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  web3x is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public License
  along with web3x.  If not, see <http://www.gnu.org/licenses/>.
*/
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const subscriptions_1 = require("../subscriptions");
const utils_1 = require("../utils");
const formatters_1 = require("../formatters");
const util_1 = require("util");
const promievent_1 = require("../promievent");
const confirm_transaction_1 = require("./confirm-transaction");
const eth_request_payloads_1 = require("./eth-request-payloads");
class Eth {
    constructor(provider) {
        this.provider = provider;
        this.request = new eth_request_payloads_1.EthRequestPayloads(undefined, 'latest');
    }
    setWallet(wallet) {
        this.wallet = wallet;
    }
    getDefaultFromAddress() {
        return this.request.getDefaultFromAddress();
    }
    setDefaultFromAddress(address) {
        this.request.setDefaultFromAddress(address);
    }
    send({ method, params, format }) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return format(yield this.provider.send(method, params));
        });
    }
    getId() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getId());
        });
    }
    getNodeInfo() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getNodeInfo());
        });
    }
    getProtocolVersion() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getProtocolVersion());
        });
    }
    getCoinbase() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getCoinbase());
        });
    }
    isMining() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.isMining());
        });
    }
    getHashrate() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getHashrate());
        });
    }
    isSyncing() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.isSyncing());
        });
    }
    getGasPrice() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getGasPrice());
        });
    }
    getAccounts() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getAccounts());
        });
    }
    getBlockNumber() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getBlockNumber());
        });
    }
    getBalance(address, block) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getBalance(address, block));
        });
    }
    getStorageAt(address, position, block) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getStorageAt(address, position, block));
        });
    }
    getCode(address, block) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getCode(address, block));
        });
    }
    getBlock(block, returnTransactionObjects = false) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getBlock(block, returnTransactionObjects));
        });
    }
    getUncle(block, uncleIndex, returnTransactionObjects = false) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getUncle(block, uncleIndex, returnTransactionObjects));
        });
    }
    getBlockTransactionCount(block) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getBlockTransactionCount(block));
        });
    }
    getBlockUncleCount(block) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getBlockUncleCount(block));
        });
    }
    getTransaction(hash) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getTransaction(hash));
        });
    }
    getTransactionFromBlock(block, index) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getTransactionFromBlock(block, index));
        });
    }
    getTransactionReceipt(hash) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getTransactionReceipt(hash));
        });
    }
    getTransactionCount(address, block) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getTransactionCount(address, block));
        });
    }
    signTransaction(tx) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.signTransaction(tx));
        });
    }
    sendSignedTransaction(data, extraFormatters, defer) {
        defer = defer || promievent_1.promiEvent();
        const payload = this.request.sendSignedTransaction(data);
        this.sendTransactionAndWaitForConfirmation(defer, payload, extraFormatters);
        return defer.eventEmitter;
    }
    sendTransaction(tx, extraFormatters) {
        // TODO: Can we remove extraFormatters, which is basically exposing contract internals here, and instead
        // wrap the returned PromiEvent in another PromiEvent that does the translations upstream?
        const defer = promievent_1.promiEvent();
        this.sendTransactionAsync(defer, tx, extraFormatters).catch(err => {
            utils_1.fireError(err, defer.eventEmitter, defer.reject);
        });
        return defer.eventEmitter;
    }
    getAccount(address) {
        address = address || this.request.getDefaultFromAddress();
        if (this.wallet && address) {
            return this.wallet.get(address);
        }
    }
    sendTransactionAsync(defer, tx, extraFormatters) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const account = this.getAccount(tx.from);
            if (!tx.gasPrice) {
                tx.gasPrice = yield this.getGasPrice();
            }
            let payload;
            if (!account) {
                payload = this.request.sendTransaction(tx);
            }
            else {
                const { from } = tx, fromlessTx = tslib_1.__rest(tx, ["from"]);
                const signedTx = yield account.signTransaction(fromlessTx, this);
                payload = this.request.sendSignedTransaction(signedTx.rawTransaction);
            }
            this.sendTransactionAndWaitForConfirmation(defer, payload, extraFormatters);
        });
    }
    sendTransactionAndWaitForConfirmation(defer, payload, extraFormatters) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                const result = yield this.send(payload);
                defer.eventEmitter.emit('transactionHash', result);
                confirm_transaction_1.confirmTransaction(defer, result, payload, this, extraFormatters);
            }
            catch (err) {
                utils_1.fireError(err, defer.eventEmitter, defer.reject);
            }
        });
    }
    sign(address, dataToSign) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const account = this.getAccount(address);
            if (!account) {
                return yield this.send(this.request.sign(address, dataToSign));
            }
            else {
                const sig = account.sign(dataToSign);
                return sig.signature;
            }
        });
    }
    signTypedData(address, dataToSign) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.signTypedData(address, dataToSign));
        });
    }
    call(tx, block, outputFormatter = result => result) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.call(tx, block, outputFormatter));
        });
    }
    estimateGas(tx) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.estimateGas(tx));
        });
    }
    submitWork(nonce, powHash, digest) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.submitWork(nonce, powHash, digest));
        });
    }
    getWork() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getWork());
        });
    }
    getPastLogs(options) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            return yield this.send(this.request.getPastLogs(options));
        });
    }
    subscribeLogs(options = {}) {
        const { fromBlock } = options, subLogOptions = tslib_1.__rest(options, ["fromBlock"]);
        const subscription = new subscriptions_1.Subscription('eth', 'logs', [formatters_1.inputLogFormatter(subLogOptions)], this.provider);
        subscription.on('rawdata', result => {
            const output = formatters_1.outputLogFormatter(result);
            if (output.removed) {
                subscription.emit('changed', output);
            }
            else {
                subscription.emit('data', output);
            }
        });
        if (fromBlock !== undefined) {
            this.getPastLogs(options)
                .then(logs => {
                logs.forEach(log => subscription.emit('rawdata', log));
                subscription.subscribe();
            })
                .catch(err => {
                subscription.emit('error', err);
            });
        }
        else {
            process.nextTick(() => subscription.subscribe());
        }
        return subscription;
    }
    subscribeSyncing() {
        const subscription = new subscriptions_1.Subscription('eth', 'syncing', [], this.provider);
        subscription.on('rawdata', result => {
            const output = formatters_1.outputSyncingFormatter(result);
            if (util_1.isBoolean(output)) {
                subscription.emit('changed', output);
                return;
            }
            subscription.emit('data', output);
        });
        process.nextTick(() => subscription.subscribe());
        return subscription;
    }
    subscribeNewBlockHeaders() {
        const subscription = new subscriptions_1.Subscription('eth', 'newHeads', [], this.provider);
        subscription.on('rawdata', result => {
            const output = formatters_1.outputBlockFormatter(result);
            subscription.emit('data', output);
        });
        process.nextTick(() => subscription.subscribe());
        return subscription;
    }
    subscribePendingTransactions() {
        const subscription = new subscriptions_1.Subscription('eth', 'newPendingTransactions', [], this.provider);
        subscription.on('rawdata', result => subscription.emit('data', result));
        process.nextTick(() => subscription.subscribe());
        return subscription;
    }
    subscribe(type, ...args) {
        switch (type) {
            case 'logs':
                return this.subscribeLogs(...args);
            case 'syncing':
                return this.subscribeSyncing();
            case 'newBlockHeaders':
                return this.subscribeNewBlockHeaders();
            case 'pendingTransactions':
                return this.subscribePendingTransactions();
            default:
                throw new Error(`Unknown subscription type: ${type}`);
        }
    }
}
exports.Eth = Eth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXRoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2V0aC9ldGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7RUFlRTs7O0FBRUYsb0RBQWdEO0FBRWhELG9DQUFxQztBQUNyQyw4Q0FVdUI7QUFDdkIsK0JBQWlDO0FBR2pDLDhDQUF5RTtBQUN6RSwrREFBMkQ7QUFDM0QsaUVBQTREO0FBa0I1RCxNQUFhLEdBQUc7SUFJZCxZQUFxQixRQUEwQjtRQUExQixhQUFRLEdBQVIsUUFBUSxDQUFrQjtRQUM3QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUkseUNBQWtCLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRCxTQUFTLENBQUMsTUFBZTtRQUN2QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQscUJBQXFCO1FBQ25CLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQzlDLENBQUM7SUFFRCxxQkFBcUIsQ0FBQyxPQUFnQjtRQUNwQyxJQUFJLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFYSxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBbUQ7O1lBQzVGLE9BQU8sTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQztLQUFBO0lBRUssS0FBSzs7WUFDVCxPQUFPLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDL0MsQ0FBQztLQUFBO0lBRUssV0FBVzs7WUFDZixPQUFPLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FB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