"use strict";
const context_1 = require("../context");
const config_loading_1 = require("../core/config/config-loading");
const buidler_params_1 = require("../core/params/buidler-params");
const env_variables_1 = require("../core/params/env-variables");
const runtime_environment_1 = require("../core/runtime-environment");
let env;
if (!context_1.BuidlerContext.isCreated()) {
    context_1.BuidlerContext.createBuidlerContext();
}
const ctx = context_1.BuidlerContext.getBuidlerContext();
if (ctx.environment !== undefined) {
    env = ctx.environment;
}
else {
    const buidlerArguments = env_variables_1.getEnvBuidlerArguments(buidler_params_1.BUIDLER_PARAM_DEFINITIONS, process.env);
    const config = config_loading_1.loadConfigAndTasks(buidlerArguments.config);
    env = new runtime_environment_1.Environment(config, buidlerArguments, ctx.tasksDSL.getTaskDefinitions(), ctx.extendersManager.getExtenders());
    ctx.setBuidlerRuntimeEnvironment(env);
}
module.exports = env;
//# sourceMappingURL=buidler-lib.js.map